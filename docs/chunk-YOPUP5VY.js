import{a as v}from"./chunk-WNSDQQTU.js";import{E as l,H as g,d as a,h as m}from"./chunk-N7OEIV7C.js";import{d as y,e as $}from"./chunk-EQDQRRRY.js";var j=y((_,b)=>{"use strict";function O(n){for(var e={},s=[],t=0,i=n.length;t<i;++t)Object.prototype.hasOwnProperty.call(e,n[t])||(s.push(n[t]),e[n[t]]=1);return s}function d(n,e){var s,t,i,r,o;for(i=n,o=!1,s=0;s<e.length;s++)for(r=e[s].split(","),t=0;t<r.length;t++){if(!i.hasOwnProperty(r[t]))i[r[t]]={};else if(i.hasOwnProperty("*")&&Object.keys(i["*"]).length===0)return n;r.length>1?(o=o||e.slice(s+1),i[r[t]]=d(i[r[t]],o),s=e.length):i=i[r[t]]}return o||(i["*"]={}),n}function h(n,e){var s,t;for(t=n,(e.length<1||e[e.length-1]!=="*")&&e.push("*"),s=0;s<e.length;s++){if(t.hasOwnProperty("*")&&Object.keys(t["*"]).length===0)return!0;if(t.hasOwnProperty("*")&&e[s]!=="*"&&t.hasOwnProperty(e[s]))return h(t["*"],e.slice(s+1))||h(t[e[s]],e.slice(s+1));if(t.hasOwnProperty("*"))t=t["*"];else if(t.hasOwnProperty(e[s]))t=t[e[s]];else if(!t.hasOwnProperty(e[s]))return!1}return!0}function f(n,e){var s,t;if(!n||!e||typeof n!="object"||!Array.isArray(e)||Object.keys(n).length<1||e.length<1)return[];if(n.hasOwnProperty("*")&&Object.keys(n["*"]).length===0)return["*"];if(e=[].concat(e),s=e.shift(),s==="?"){if(t=Object.keys(n),e.length>0){var i={};return t.forEach(function(u){i[u]=P(n[u],e)}),t.filter(function(u){return i[u].length>0})}return t}if(s==="$"){t=[],Object.keys(n).forEach(function(x){t=t.concat(f(n[x],[].concat(e)))});for(var r=O(t),o=r.length-1;o>=0;o--)r[o]==="*"&&r.splice(o,1);return r}return t=[],n.hasOwnProperty(s)&&(t=t.concat(f(n[s],e))),n.hasOwnProperty("*")&&(t=t.concat(f(n["*"],e))),t}function w(n){var e=[],s=n.split(":"),t,i;for(t=0;t<s.length;t++)i=s[t].split(","),e.length===0?e=i:(i=i.map(function(r){return e.map(function(o){return o+":"+r},this)},this),e=[].concat.apply([],O(i)));return e}function P(n,e){var s=[].concat(e);return Object.keys(n).map(function(t){var i=!1;if(t==="*"){if(e.length<=1||Object.keys(n[t]).length===0)return[t];i=!0}if(t==="*"||e[0]===t||e[0]==="$"){if(e.length<=1)return[t];i=!0}if(!i)return[];var r=P(n[t],e.slice(1));return r.map(function(o){return t+":"+o})}).reduce(function(t,i){return t.concat(i)},[])}var c=function(){return this.data={},this};c.prototype.reset=function(){return this.data={},this};c.prototype.add=function(){var n=[].concat.apply([],arguments),e;for(e in n)if(n.hasOwnProperty(e)&&typeof n[e]=="string"){var s=n[e].split(":");s[s.length-1]==="*"&&s.splice(s.length-1,1),this.data=d(this.data,s)}return this};c.prototype.check=function(n){return typeof n!="string"?!1:n.indexOf(",")!==-1?w(n).map(function(e){return h(this.data,e.split(":"))},this).every(Boolean):h(this.data,n.split(":"))};c.prototype.get=function(){return this.data};c.prototype.permissions=function(n){return typeof n!="string"?[]:f(this.data,n.split(":"))};b.exports={new:function(){return new c},newTrie:function(){return new c},_expand:w}});var k=$(j());var p=class{constructor(){this.trie=(0,k.newTrie)()}apply(){this.trie.reset(),this.trie.add(...this.getPermissions())}isPermittedAsync(e){return this.permissions$.pipe(m(()=>this._isPermitted(e)))}isPermitted(e){return this._isPermitted(e)}_isPermitted(e){return this.trie.check(e)}},B=(()=>{class n extends p{constructor(s){super(),this.subject=s,this.permissions$=this.subject.authorities$}getPermissions(){return this.subject.getAuthorities()}static{this.\u0275fac=function(t){return new(t||n)(g(v))}}static{this.\u0275prov=l({token:n,factory:n.\u0275fac})}}return n})(),E=(()=>{class n extends p{constructor(){super(),this.permissions=new a([]),this.permissions$=this.permissions.asObservable(),this.apply()}ngOnDestroy(){this.permissions.complete()}getPermissions(){return this.permissions.getValue()}update(s){this.permissions.next(s)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=l({token:n,factory:n.\u0275fac})}}return n})();export{p as a,B as b,E as c};
